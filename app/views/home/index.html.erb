<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" href="/assets/home.scss">
    </head>

    <body>
        <header>
            <div class="containerOfContents">
                <div class="profileOfUser">
                    <% if user_signed_in? %>
                        <div class="contentOfProfile">
                            <!--<div class="name"><%= current_user.email %></div>-->
                            <%= button_to "OUT", destroy_user_session_path, class:"buttonOfSignout", method: :delete, form: { data: { turbo: :false } } %>
                        </div> 
                    <% end %>
                </div>
                <div class="buttonOfToss">
                    <div class="contentsOfButton">
                        <span class="textOfEffect">#</span>
                        <span>findyourfuturecompany </span>
                        <img src="/assets/imagesOfTitle2.png"/>
                    </div>
                </div>
            </div>
        </header>
        <article>

            <div class="description"> 
                <span>í“¨ì²˜ì»´í¼ë‹ˆíŒ€ì—ì„œ ì›í•˜ëŠ” íšŒì‚¬ ì •ë³´ë¥¼ ë¹ ë¥´ê²Œ ì–»ì–´ë³´ì„¸ìš”!</span>
            </div>

            <div class="containerOfInput">
                <form>
                    <div class="boxOfFirst">
                        <!-- <span>ğŸ’¼</span> -->
                        <p>ì²« ë²ˆì§¸ ì§€ë§ íšŒì‚¬</p>
                        <input type="text" id="inputOfFirst" value="" placeholder="ì·¨ë½€í•©ì‹œë‹¤ ì·¨ë½€ ğŸ”¥"/>
                        <ul class="resultOfFirst">
                        </ul>

                    </div>
                    <div class="boxOfTwice">
                        <p>2ì§€ë§ íšŒì‚¬</p>
                        <input type="text" id="inputOfTwice" value=""/>
                        <p class="resultOfTwice"> - </p>
                    </div>
                </form>
            </div>
            </div>
        </article>
        <div class="dataOfCompany">
        </div>
    </body>
    
    <script>

        const inputOfFirst = document.querySelector("#inputOfFirst");
        const inputOfTwice = document.querySelector("#inputOfTwice");

        const button = document.querySelector("#buttonOfSubmit");
        const nameOfCompany = Array.from(document.getElementsByClassName("nameOfCompany"));

        const resultOfFirst = document.querySelector(".resultOfFirst");
        const resultOfTwice = document.querySelector(".resultOfTwice");
        let companyInfo = []
        let companyData = []               

        // ê¹ƒ ì•¡ì…˜ìœ¼ë¡œ í¬ë¡¤ë§ í•´ì˜¨ ë°ì´í„°ë¥¼ Fetch ë©”ì†Œë“œë¥¼ í†µí•´ í˜¸ì¶œí•˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤.
        async function getCompanyInfo() {
            const data = await fetch('https://raw.githubusercontent.com/klmhyeonwoo/-findyourfuturecompany/develop/companyInfo/news.json')
            .then((res) => res.json())
            const scaledData = await data;
            for (let i in scaledData) {
                companyInfo.push(
                    {
                        "name" : i,
                        "content" : data[i]
                    }
                )
            }
            return companyInfo
        }

        // ë…¸ë“œë¥¼ ì¶”ê°€í•´ì£¼ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤.
        function addNode(companyData, inputUser) { 
            const companyBox = document.createElement('li');
            const colorText = document.createElement('span')
            colorText.classList.add("colorText");
            colorText.innerHTML = inputUser
            const noneText = document.createElement('span')
            noneText.innerHTML = companyData.slice(inputUser.length,)
            companyBox.append(colorText, noneText)
            resultOfFirst.append(companyBox);
        }

        // INPUTì—ì„œ ë°›ì•„ì˜¨ ë°°ì—´ì˜ ì¤‘ë³µ ê°’ì„ ì—†ì•¤ ê°€ê³µëœ ë°°ì—´ê³¼, ì‚¬ìš©ìì˜ ì…ë ¥ì„ ë§¤ì¹­í•´ì¤ë‹ˆë‹¤.
        function scaledCompanyInfo(array, inputOfUser) {
            if (array.length >= 2) {
                if (inputOfUser.length >= 1) {
                    array.map((company) => {
                        if (company.includes(inputOfUser)) {
                            company = company.replace('ãˆœ', "");
                            if (company.indexOf(inputOfUser) === 0) {
                                addNode(company, inputOfUser)
                            }
                        }
                    })
                }
            }
        }

        // ì‚¬ìš©ìê°€ ì…ë ¥ì„ ë‹¤ í•˜ê³  Nodeë¥¼ ì´ˆê¸°í™” í•´ì£¼ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤.
        function removeNode(item) {
            const parent = document.querySelector(".resultOfFirst");
            parent.innerHTML = ""
        }

        // ì‚¬ìš©ìì˜ ì…ë ¥ ê°’ê³¼ ë§¤ì¹­ë˜ëŠ” ë°°ì—´ì„ companyData ë°°ì—´ì— ìƒˆë¡­ê²Œ ì¶”ê°€ë¥¼ í•´ì¤ë‹ˆë‹¤.
        function checkOfItem(newValue) {
                // ì‚¬ìš©ìê°€ ì…ë ¥í•œ ê°’ê³¼ ë§¤ì¹­ë˜ëŠ” íšŒì‚¬ ì •ë³´ë¥¼ ë°°ì—´ ì •ë³´ì— ë„£ì–´ì¤ë‹ˆë‹¤.
                getCompanyInfo()
                .then(
                    (data) => data.map((item) => {
                        companyData.push(item["name"])
                }))
            return companyData
        }

        inputOfFirst.addEventListener("input", function(event) { 
            let dataOfInput = checkOfItem(event.target.value);
            dataOfInput = dataOfInput.filter((element, index) => {
                return dataOfInput.indexOf(element) === index
            })
            removeNode()
            scaledCompanyInfo(dataOfInput, event.target.value);
            companyInfo = []
        })

        inputOfTwice.addEventListener("input", function(event) {
            if (event.target.value === "ì•ˆë…•") { 
                const companyBox = document.createElement('div');
                companyBox.innerHTML = "test"
                document.body.append(event.target.value);
            }

        })
        
        function init() {
        }

        init();
    </script>
</html>